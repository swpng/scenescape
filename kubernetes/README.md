# Intel® SceneScape on Kubernetes

## Overview

This folder contains the helm chart to run Intel® SceneScape on Kubernetes.

This readme goes through a minimal setup for running this on your local development machine with only 3 extra binaries needed. The default Makefile target starts a Kubernetes cluster in a Docker container using kind, then deploys Intel® SceneScape to that cluster using helm.

Advanced users intending to deploy this in production will have to change the default chart values or modify the templates.

There are 2 main ways to install Intel® SceneScape on Kubernetes:

1. [All-in-one (Kind + Registry + SceneScape)](#all-in-one) - for development and testing using locally built SceneScape images
2. [SceneScape only](#scenescape-only) - for existing clusters and published SceneScape images

## All-in-one

The easiest way to install Intel® SceneScape on [Kind](https://kind.sigs.k8s.io/) is with a single command:

```sh
KUBERNETES=1 ./deploy.sh
```

This will:

- Start a kind cluster and local registry (if needed)
- Install [Cert Manager](https://cert-manager.io/)
- Build and push all required images
- Autogenerate a strong admin UI password (SUPASS)
- Deploy Intel® SceneScape to the cluster using Helm

When the webUI is up, log in with `admin` and the autogenerated password. By default, the password is generated by `deploy.sh` and will be printed to the console after installation completes.

> **Note:** You can retrieve the generated admin password at any time with:
>
> ```sh
> helm get values scenescape -n scenescape
> ```

Save this password for future logins. You can change the admin password later via the web UI after logging in.

### Useful targets

- Install SceneScape: `make -C kubernetes install`
- Uninstall (leave kind cluster running): `make -C kubernetes uninstall`
- Remove all: `make -C kubernetes clean-all`

## SceneScape Only

If you already have a Kubernetes cluster you can use the Helm chart directly.

**Prerequisites:**

1. Install [Cert Manager](https://cert-manager.io/) in your cluster.

2. Copy common scripts to chart folder:

```sh
make copy-files
```

**Install with a custom admin password:**

```sh
helm install scenescape scenescape-chart -n <NAMESPACE> --create-namespace \
   --set supass=<YOUR_ADMIN_PASSWORD> \
   --set pgserver.password=<YOUR_POSTGRES_PASSWORD>
```

Optionally, prepare updated [values file](scenescape-chart/values.yaml) and save it as `values-custom.yaml`.

```sh
helm install scenescape scenescape-chart -n <NAMESPACE> --create-namespace \
   --set supass=<YOUR_ADMIN_PASSWORD> \
   --set pgserver.password=<YOUR_POSTGRES_PASSWORD> \
   --values values-custom.yaml
```

**To uninstall:**

```sh
helm uninstall scenescape -n <NAMESPACE>
```

## Environment Variables

### Proxy Configuration

If you're deploying Intel® SceneScape in an environment that requires proxy access, set these environment variables before running make commands:

```console
export http_proxy=http://your-proxy-server:port
export https_proxy=https://your-proxy-server:port
export no_proxy=localhost,127.0.0.1,.local,.svc,.svc.cluster.local,10.96.0.0/12,10.244.0.0/16,172.17.0.0/16
make -C kubernetes install
```

**What to put in `no_proxy` and why:**

- `localhost,127.0.0.1`: Ensures local traffic is not sent through the proxy.
- `.local`: Excludes local network hostnames.
- `.svc,.svc.cluster.local`: Excludes all Kubernetes service DNS names, so internal service-to-service traffic stays inside the cluster.
- `10.96.0.0/12`: Default Kubernetes service CIDR (adjust if your cluster uses a different range).
- `10.244.0.0/16`: Default pod CIDR for many CNI plugins (adjust if your cluster uses a different range).
- `172.17.0.0/16`: Typical Docker bridge network used by kind (Kubernetes IN Docker). Adjust if your Docker network uses a different subnet.

These values ensure that all internal cluster communication, including between pods and services, is not routed through the proxy. This is critical for correct operation of Kubernetes workloads, especially in kind clusters or any environment where internal networking must remain direct. Adjust the CIDRs if your cluster uses custom networking.

The proxy settings will be automatically detected and passed to all Intel® SceneScape containers as environment variables.

### NodePort Services

By default, Intel® SceneScape exposes its services using ClusterIP type services. If you want to expose them using NodePort services instead, set the following chart value:

```yaml
nodePort:
  enabled: true
```

### Chart Debug Mode

To enable Helm chart debugging (useful for troubleshooting deployment issues):

```console
export CHART_DEBUG=1
make -C kubernetes install
```

This enables the `chartdebug=true` setting in the Helm chart, which keeps debugging resources after installation.

### Validation Mode

To deploy Intel® SceneScape in validation/testing mode:

```console
export VALIDATION=1
make -C kubernetes install
```

This enables additional testing components and configurations.
